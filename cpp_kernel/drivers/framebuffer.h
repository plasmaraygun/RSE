#pragma once

/**
 * Framebuffer Driver
 * Provides text and graphics output to screen
 */

#include <cstdint>
#include "../boot/multiboot.h"

namespace drivers {

// VGA text mode colors
enum class Color : uint8_t {
    BLACK = 0,
    BLUE = 1,
    GREEN = 2,
    CYAN = 3,
    RED = 4,
    MAGENTA = 5,
    BROWN = 6,
    LIGHT_GRAY = 7,
    DARK_GRAY = 8,
    LIGHT_BLUE = 9,
    LIGHT_GREEN = 10,
    LIGHT_CYAN = 11,
    LIGHT_RED = 12,
    LIGHT_MAGENTA = 13,
    YELLOW = 14,
    WHITE = 15
};

// PSF font header
struct PSFHeader {
    uint16_t magic;
    uint8_t mode;
    uint8_t charsize;
};

constexpr uint16_t PSF_MAGIC = 0x0436;

// Default 8x16 font (subset)
constexpr uint8_t DEFAULT_FONT_WIDTH = 8;
constexpr uint8_t DEFAULT_FONT_HEIGHT = 16;

class Framebuffer {
private:
    uint32_t* buffer_;
    uint32_t width_;
    uint32_t height_;
    uint32_t pitch_;
    uint8_t bpp_;
    
    uint32_t cursor_x_;
    uint32_t cursor_y_;
    uint32_t fg_color_;
    uint32_t bg_color_;
    
    uint32_t char_width_;
    uint32_t char_height_;
    uint32_t cols_;
    uint32_t rows_;
    
    // Built-in 8x16 font glyphs (ASCII 32-126)
    static const uint8_t font_data_[];
    
    void putPixel(uint32_t x, uint32_t y, uint32_t color) {
        if (x >= width_ || y >= height_) return;
        uint32_t* pixel = reinterpret_cast<uint32_t*>(
            reinterpret_cast<uint8_t*>(buffer_) + y * pitch_ + x * (bpp_ / 8)
        );
        *pixel = color;
    }
    
    void drawChar(uint32_t x, uint32_t y, char c) {
        if (c < 32 || c > 126) c = '?';
        
        const uint8_t* glyph = &font_data_[(c - 32) * char_height_];
        
        for (uint32_t row = 0; row < char_height_; row++) {
            uint8_t bits = glyph[row];
            for (uint32_t col = 0; col < char_width_; col++) {
                uint32_t color = (bits & (0x80 >> col)) ? fg_color_ : bg_color_;
                putPixel(x + col, y + row, color);
            }
        }
    }
    
    void scroll() {
        // Move all rows up by one
        uint32_t row_bytes = pitch_ * char_height_;
        uint8_t* dst = reinterpret_cast<uint8_t*>(buffer_);
        uint8_t* src = dst + row_bytes;
        uint32_t copy_size = (rows_ - 1) * row_bytes;
        
        __builtin_memmove(dst, src, copy_size);
        
        // Clear last row
        uint8_t* last_row = dst + copy_size;
        for (uint32_t y = 0; y < char_height_; y++) {
            uint32_t* row = reinterpret_cast<uint32_t*>(last_row + y * pitch_);
            for (uint32_t x = 0; x < width_; x++) {
                row[x] = bg_color_;
            }
        }
        
        cursor_y_--;
    }

public:
    Framebuffer() : buffer_(nullptr), width_(0), height_(0), pitch_(0), bpp_(0),
                    cursor_x_(0), cursor_y_(0), fg_color_(0xFFFFFF), bg_color_(0x000000),
                    char_width_(DEFAULT_FONT_WIDTH), char_height_(DEFAULT_FONT_HEIGHT),
                    cols_(0), rows_(0) {}
    
    bool init(const boot::BootInfo& info) {
        if (info.framebuffer_addr == 0) return false;
        
        buffer_ = reinterpret_cast<uint32_t*>(info.framebuffer_addr);
        width_ = info.framebuffer_width;
        height_ = info.framebuffer_height;
        pitch_ = info.framebuffer_pitch;
        bpp_ = info.framebuffer_bpp;
        
        cols_ = width_ / char_width_;
        rows_ = height_ / char_height_;
        
        clear();
        return true;
    }
    
    // VGA text mode fallback
    bool initVGA() {
        buffer_ = reinterpret_cast<uint32_t*>(0xB8000);
        width_ = 80;
        height_ = 25;
        pitch_ = 160;
        bpp_ = 16;
        cols_ = 80;
        rows_ = 25;
        char_width_ = 1;
        char_height_ = 1;
        
        clear();
        return true;
    }
    
    void clear() {
        if (bpp_ == 16) {
            // VGA text mode
            uint16_t* vga = reinterpret_cast<uint16_t*>(buffer_);
            for (uint32_t i = 0; i < cols_ * rows_; i++) {
                vga[i] = 0x0F00 | ' ';  // White on black, space
            }
        } else {
            // Framebuffer mode
            uint8_t* ptr = reinterpret_cast<uint8_t*>(buffer_);
            for (uint32_t y = 0; y < height_; y++) {
                uint32_t* row = reinterpret_cast<uint32_t*>(ptr + y * pitch_);
                for (uint32_t x = 0; x < width_; x++) {
                    row[x] = bg_color_;
                }
            }
        }
        cursor_x_ = 0;
        cursor_y_ = 0;
    }
    
    void putchar(char c) {
        if (bpp_ == 16) {
            // VGA text mode
            uint16_t* vga = reinterpret_cast<uint16_t*>(buffer_);
            
            if (c == '\n') {
                cursor_x_ = 0;
                cursor_y_++;
            } else if (c == '\r') {
                cursor_x_ = 0;
            } else if (c == '\t') {
                cursor_x_ = (cursor_x_ + 8) & ~7;
            } else if (c == '\b') {
                if (cursor_x_ > 0) cursor_x_--;
            } else {
                vga[cursor_y_ * cols_ + cursor_x_] = 0x0F00 | c;
                cursor_x_++;
            }
            
            if (cursor_x_ >= cols_) {
                cursor_x_ = 0;
                cursor_y_++;
            }
            
            if (cursor_y_ >= rows_) {
                // Scroll VGA
                __builtin_memmove(vga, vga + cols_, (rows_ - 1) * cols_ * 2);
                for (uint32_t x = 0; x < cols_; x++) {
                    vga[(rows_ - 1) * cols_ + x] = 0x0F00 | ' ';
                }
                cursor_y_ = rows_ - 1;
            }
        } else {
            // Framebuffer mode
            if (c == '\n') {
                cursor_x_ = 0;
                cursor_y_++;
            } else if (c == '\r') {
                cursor_x_ = 0;
            } else if (c == '\t') {
                cursor_x_ = (cursor_x_ + 8) & ~7;
            } else if (c == '\b') {
                if (cursor_x_ > 0) {
                    cursor_x_--;
                    drawChar(cursor_x_ * char_width_, cursor_y_ * char_height_, ' ');
                }
            } else {
                drawChar(cursor_x_ * char_width_, cursor_y_ * char_height_, c);
                cursor_x_++;
            }
            
            if (cursor_x_ >= cols_) {
                cursor_x_ = 0;
                cursor_y_++;
            }
            
            if (cursor_y_ >= rows_) {
                scroll();
            }
        }
    }
    
    void write(const char* str) {
        while (*str) {
            putchar(*str++);
        }
    }
    
    void setColor(uint32_t fg, uint32_t bg) {
        fg_color_ = fg;
        bg_color_ = bg;
    }
    
    void setCursor(uint32_t x, uint32_t y) {
        cursor_x_ = x;
        cursor_y_ = y;
    }
    
    uint32_t getCols() const { return cols_; }
    uint32_t getRows() const { return rows_; }
    uint32_t getWidth() const { return width_; }
    uint32_t getHeight() const { return height_; }
    
    // Draw rectangle
    void fillRect(uint32_t x, uint32_t y, uint32_t w, uint32_t h, uint32_t color) {
        for (uint32_t row = y; row < y + h && row < height_; row++) {
            for (uint32_t col = x; col < x + w && col < width_; col++) {
                putPixel(col, row, color);
            }
        }
    }
    
    // Printf-style output
    void printf(const char* fmt, ...) {
        char buf[1024];  // Format buffer for printf
        __builtin_va_list args;
        __builtin_va_start(args, fmt);
        
        char* out = buf;
        while (*fmt && (out - buf) < 1020) {
            if (*fmt == '%' && *(fmt + 1)) {
                fmt++;
                switch (*fmt) {
                    case 's': {
                        const char* s = __builtin_va_arg(args, const char*);
                        if (!s) s = "(null)";
                        while (*s) *out++ = *s++;
                        break;
                    }
                    case 'd': {
                        int val = __builtin_va_arg(args, int);
                        if (val < 0) { *out++ = '-'; val = -val; }
                        char tmp[12]; int i = 0;
                        do { tmp[i++] = '0' + (val % 10); val /= 10; } while (val);
                        while (i--) *out++ = tmp[i];
                        break;
                    }
                    case 'x': {
                        unsigned val = __builtin_va_arg(args, unsigned);
                        static const char hex[] = "0123456789abcdef";
                        char tmp[8]; int i = 0;
                        do { tmp[i++] = hex[val & 0xF]; val >>= 4; } while (val);
                        while (i--) *out++ = tmp[i];
                        break;
                    }
                    case 'c':
                        *out++ = static_cast<char>(__builtin_va_arg(args, int));
                        break;
                    case '%':
                        *out++ = '%';
                        break;
                }
            } else {
                *out++ = *fmt;
            }
            fmt++;
        }
        *out = '\0';
        
        __builtin_va_end(args);
        write(buf);
    }
};

// Complete 8x16 bitmap font for ASCII 32-126 (95 printable characters)
// Each character is 16 bytes (8 pixels wide x 16 rows)
inline const uint8_t Framebuffer::font_data_[] = {
    // Space (32)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // ! (33)
    0x00,0x00,0x18,0x3C,0x3C,0x3C,0x18,0x18,0x18,0x00,0x18,0x18,0x00,0x00,0x00,0x00,
    // " (34)
    0x00,0x63,0x63,0x63,0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // # (35)
    0x00,0x00,0x00,0x36,0x36,0x7F,0x36,0x36,0x36,0x7F,0x36,0x36,0x00,0x00,0x00,0x00,
    // $ (36)
    0x0C,0x0C,0x3E,0x63,0x61,0x60,0x3E,0x03,0x03,0x43,0x63,0x3E,0x0C,0x0C,0x00,0x00,
    // % (37)
    0x00,0x00,0x00,0x00,0x00,0x61,0x63,0x06,0x0C,0x18,0x33,0x63,0x00,0x00,0x00,0x00,
    // & (38)
    0x00,0x00,0x00,0x1C,0x36,0x36,0x1C,0x3B,0x6E,0x66,0x66,0x3B,0x00,0x00,0x00,0x00,
    // ' (39)
    0x00,0x30,0x30,0x30,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // ( (40)
    0x00,0x00,0x0C,0x18,0x18,0x30,0x30,0x30,0x30,0x18,0x18,0x0C,0x00,0x00,0x00,0x00,
    // ) (41)
    0x00,0x00,0x18,0x0C,0x0C,0x06,0x06,0x06,0x06,0x0C,0x0C,0x18,0x00,0x00,0x00,0x00,
    // * (42)
    0x00,0x00,0x00,0x00,0x42,0x66,0x3C,0xFF,0x3C,0x66,0x42,0x00,0x00,0x00,0x00,0x00,
    // + (43)
    0x00,0x00,0x00,0x00,0x18,0x18,0x18,0xFF,0x18,0x18,0x18,0x00,0x00,0x00,0x00,0x00,
    // , (44)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0x30,0x00,0x00,
    // - (45)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // . (46)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,
    // / (47)
    0x00,0x00,0x01,0x03,0x07,0x0E,0x1C,0x38,0x70,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,
    // 0 (48)
    0x00,0x00,0x3E,0x63,0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x3E,0x00,0x00,0x00,0x00,
    // 1 (49)
    0x00,0x00,0x0C,0x1C,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3F,0x00,0x00,0x00,0x00,
    // 2 (50)
    0x00,0x00,0x3E,0x63,0x03,0x06,0x0C,0x18,0x30,0x61,0x63,0x7F,0x00,0x00,0x00,0x00,
    // 3 (51)
    0x00,0x00,0x3E,0x63,0x03,0x03,0x1E,0x03,0x03,0x03,0x63,0x3E,0x00,0x00,0x00,0x00,
    // 4 (52)
    0x00,0x00,0x06,0x0E,0x1E,0x36,0x66,0x66,0x7F,0x06,0x06,0x0F,0x00,0x00,0x00,0x00,
    // 5 (53)
    0x00,0x00,0x7F,0x60,0x60,0x60,0x7E,0x03,0x03,0x63,0x73,0x3E,0x00,0x00,0x00,0x00,
    // 6 (54)
    0x00,0x00,0x1C,0x30,0x60,0x60,0x7E,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00,0x00,
    // 7 (55)
    0x00,0x00,0x7F,0x63,0x03,0x06,0x0C,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00,
    // 8 (56)
    0x00,0x00,0x3E,0x63,0x63,0x63,0x3E,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00,0x00,
    // 9 (57)
    0x00,0x00,0x3E,0x63,0x63,0x63,0x63,0x3F,0x03,0x03,0x06,0x3C,0x00,0x00,0x00,0x00,
    // : (58)
    0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00,
    // ; (59)
    0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x30,0x00,0x00,0x00,0x00,
    // < (60)
    0x00,0x00,0x00,0x06,0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x06,0x00,0x00,0x00,0x00,
    // = (61)
    0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,
    // > (62)
    0x00,0x00,0x00,0x60,0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x60,0x00,0x00,0x00,0x00,
    // ? (63)
    0x00,0x00,0x3E,0x63,0x63,0x06,0x0C,0x0C,0x0C,0x00,0x0C,0x0C,0x00,0x00,0x00,0x00,
    // @ (64)
    0x00,0x00,0x3E,0x63,0x63,0x6F,0x6B,0x6B,0x6E,0x60,0x60,0x3E,0x00,0x00,0x00,0x00,
    // A (65)
    0x00,0x00,0x08,0x1C,0x36,0x63,0x63,0x7F,0x63,0x63,0x63,0x63,0x00,0x00,0x00,0x00,
    // B (66)
    0x00,0x00,0x7E,0x33,0x33,0x33,0x3E,0x33,0x33,0x33,0x33,0x7E,0x00,0x00,0x00,0x00,
    // C (67)
    0x00,0x00,0x1E,0x33,0x61,0x60,0x60,0x60,0x60,0x61,0x33,0x1E,0x00,0x00,0x00,0x00,
    // D (68)
    0x00,0x00,0x7C,0x36,0x33,0x33,0x33,0x33,0x33,0x33,0x36,0x7C,0x00,0x00,0x00,0x00,
    // E (69)
    0x00,0x00,0x7F,0x33,0x31,0x34,0x3C,0x34,0x30,0x31,0x33,0x7F,0x00,0x00,0x00,0x00,
    // F (70)
    0x00,0x00,0x7F,0x33,0x31,0x34,0x3C,0x34,0x30,0x30,0x30,0x78,0x00,0x00,0x00,0x00,
    // G (71)
    0x00,0x00,0x1E,0x33,0x61,0x60,0x60,0x6F,0x63,0x63,0x37,0x1D,0x00,0x00,0x00,0x00,
    // H (72)
    0x00,0x00,0x63,0x63,0x63,0x63,0x7F,0x63,0x63,0x63,0x63,0x63,0x00,0x00,0x00,0x00,
    // I (73)
    0x00,0x00,0x3C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,
    // J (74)
    0x00,0x00,0x0F,0x06,0x06,0x06,0x06,0x06,0x06,0x66,0x66,0x3C,0x00,0x00,0x00,0x00,
    // K (75)
    0x00,0x00,0x73,0x33,0x36,0x36,0x3C,0x36,0x36,0x33,0x33,0x73,0x00,0x00,0x00,0x00,
    // L (76)
    0x00,0x00,0x78,0x30,0x30,0x30,0x30,0x30,0x30,0x31,0x33,0x7F,0x00,0x00,0x00,0x00,
    // M (77)
    0x00,0x00,0x63,0x77,0x7F,0x6B,0x63,0x63,0x63,0x63,0x63,0x63,0x00,0x00,0x00,0x00,
    // N (78)
    0x00,0x00,0x63,0x63,0x73,0x7B,0x7F,0x6F,0x67,0x63,0x63,0x63,0x00,0x00,0x00,0x00,
    // O (79)
    0x00,0x00,0x1C,0x36,0x63,0x63,0x63,0x63,0x63,0x63,0x36,0x1C,0x00,0x00,0x00,0x00,
    // P (80)
    0x00,0x00,0x7E,0x33,0x33,0x33,0x3E,0x30,0x30,0x30,0x30,0x78,0x00,0x00,0x00,0x00,
    // Q (81)
    0x00,0x00,0x3E,0x63,0x63,0x63,0x63,0x63,0x63,0x6B,0x6F,0x3E,0x06,0x07,0x00,0x00,
    // R (82)
    0x00,0x00,0x7E,0x33,0x33,0x33,0x3E,0x36,0x36,0x33,0x33,0x73,0x00,0x00,0x00,0x00,
    // S (83)
    0x00,0x00,0x3E,0x63,0x63,0x30,0x1C,0x06,0x03,0x63,0x63,0x3E,0x00,0x00,0x00,0x00,
    // T (84)
    0x00,0x00,0xFF,0xDB,0x99,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,
    // U (85)
    0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00,0x00,
    // V (86)
    0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x36,0x1C,0x08,0x00,0x00,0x00,0x00,
    // W (87)
    0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x6B,0x6B,0x7F,0x36,0x36,0x00,0x00,0x00,0x00,
    // X (88)
    0x00,0x00,0xC3,0xC3,0x66,0x3C,0x18,0x18,0x3C,0x66,0xC3,0xC3,0x00,0x00,0x00,0x00,
    // Y (89)
    0x00,0x00,0xC3,0xC3,0xC3,0x66,0x3C,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,
    // Z (90)
    0x00,0x00,0x7F,0x63,0x43,0x06,0x0C,0x18,0x30,0x61,0x63,0x7F,0x00,0x00,0x00,0x00,
    // [ (91)
    0x00,0x00,0x3C,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x3C,0x00,0x00,0x00,0x00,
    // \ (92)
    0x00,0x00,0x80,0xC0,0xE0,0x70,0x38,0x1C,0x0E,0x07,0x03,0x01,0x00,0x00,0x00,0x00,
    // ] (93)
    0x00,0x00,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00,0x00,0x00,0x00,
    // ^ (94)
    0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // _ (95)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,
    // ` (96)
    0x00,0x18,0x18,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // a (97)
    0x00,0x00,0x00,0x00,0x00,0x3C,0x46,0x06,0x3E,0x66,0x66,0x3B,0x00,0x00,0x00,0x00,
    // b (98)
    0x00,0x00,0x70,0x30,0x30,0x3C,0x36,0x33,0x33,0x33,0x33,0x6E,0x00,0x00,0x00,0x00,
    // c (99)
    0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x60,0x60,0x60,0x63,0x3E,0x00,0x00,0x00,0x00,
    // d (100)
    0x00,0x00,0x0E,0x06,0x06,0x1E,0x36,0x66,0x66,0x66,0x66,0x3B,0x00,0x00,0x00,0x00,
    // e (101)
    0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x7F,0x60,0x60,0x63,0x3E,0x00,0x00,0x00,0x00,
    // f (102)
    0x00,0x00,0x1C,0x36,0x32,0x30,0x7C,0x30,0x30,0x30,0x30,0x78,0x00,0x00,0x00,0x00,
    // g (103)
    0x00,0x00,0x00,0x00,0x00,0x3B,0x66,0x66,0x66,0x66,0x3E,0x06,0x66,0x3C,0x00,0x00,
    // h (104)
    0x00,0x00,0x70,0x30,0x30,0x36,0x3B,0x33,0x33,0x33,0x33,0x73,0x00,0x00,0x00,0x00,
    // i (105)
    0x00,0x00,0x0C,0x0C,0x00,0x1C,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00,0x00,0x00,0x00,
    // j (106)
    0x00,0x00,0x06,0x06,0x00,0x0E,0x06,0x06,0x06,0x06,0x06,0x66,0x66,0x3C,0x00,0x00,
    // k (107)
    0x00,0x00,0x70,0x30,0x30,0x33,0x33,0x36,0x3C,0x36,0x33,0x73,0x00,0x00,0x00,0x00,
    // l (108)
    0x00,0x00,0x1C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00,0x00,0x00,0x00,
    // m (109)
    0x00,0x00,0x00,0x00,0x00,0x6E,0x7F,0x6B,0x6B,0x6B,0x6B,0x6B,0x00,0x00,0x00,0x00,
    // n (110)
    0x00,0x00,0x00,0x00,0x00,0x6E,0x33,0x33,0x33,0x33,0x33,0x33,0x00,0x00,0x00,0x00,
    // o (111)
    0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00,0x00,
    // p (112)
    0x00,0x00,0x00,0x00,0x00,0x6E,0x33,0x33,0x33,0x33,0x3E,0x30,0x30,0x78,0x00,0x00,
    // q (113)
    0x00,0x00,0x00,0x00,0x00,0x3B,0x66,0x66,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00,0x00,
    // r (114)
    0x00,0x00,0x00,0x00,0x00,0x6E,0x3B,0x33,0x30,0x30,0x30,0x78,0x00,0x00,0x00,0x00,
    // s (115)
    0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x38,0x0E,0x03,0x63,0x3E,0x00,0x00,0x00,0x00,
    // t (116)
    0x00,0x00,0x08,0x18,0x18,0x7E,0x18,0x18,0x18,0x18,0x1B,0x0E,0x00,0x00,0x00,0x00,
    // u (117)
    0x00,0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x66,0x3B,0x00,0x00,0x00,0x00,
    // v (118)
    0x00,0x00,0x00,0x00,0x00,0x63,0x63,0x63,0x63,0x36,0x1C,0x08,0x00,0x00,0x00,0x00,
    // w (119)
    0x00,0x00,0x00,0x00,0x00,0x63,0x63,0x6B,0x6B,0x6B,0x7F,0x36,0x00,0x00,0x00,0x00,
    // x (120)
    0x00,0x00,0x00,0x00,0x00,0x63,0x36,0x1C,0x1C,0x1C,0x36,0x63,0x00,0x00,0x00,0x00,
    // y (121)
    0x00,0x00,0x00,0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x3F,0x03,0x06,0x3C,0x00,0x00,
    // z (122)
    0x00,0x00,0x00,0x00,0x00,0x7F,0x66,0x0C,0x18,0x30,0x63,0x7F,0x00,0x00,0x00,0x00,
    // { (123)
    0x00,0x00,0x0E,0x18,0x18,0x18,0x70,0x18,0x18,0x18,0x18,0x0E,0x00,0x00,0x00,0x00,
    // | (124)
    0x00,0x00,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00,
    // } (125)
    0x00,0x00,0x70,0x18,0x18,0x18,0x0E,0x18,0x18,0x18,0x18,0x70,0x00,0x00,0x00,0x00,
    // ~ (126)
    0x00,0x00,0x3B,0x6E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

// Global framebuffer instance
inline Framebuffer& getFramebuffer() {
    static Framebuffer fb;
    return fb;
}

} // namespace drivers
